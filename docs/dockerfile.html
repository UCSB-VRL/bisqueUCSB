<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2.1 Dockerfile | Getting Started with BisQue</title>
  <meta name="description" content="BisQue (Bio-Image Semantic Query User Environment) : Store, visualize,organize and analyze images in the cloud." />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="2.1 Dockerfile | Getting Started with BisQue" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="/images/cover.png" />
  <meta property="og:description" content="BisQue (Bio-Image Semantic Query User Environment) : Store, visualize,organize and analyze images in the cloud." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2.1 Dockerfile | Getting Started with BisQue" />
  
  <meta name="twitter:description" content="BisQue (Bio-Image Semantic Query User Environment) : Store, visualize,organize and analyze images in the cloud." />
  <meta name="twitter:image" content="/images/cover.png" />




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="module-development.html"/>
<link rel="next" href="module-xml.html"/>
<script src="libs/header-attrs-2.8/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="#index">Official UCSB BisQue Documentation</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>BisQue Service | Python API</a>
<ul>
<li class="chapter" data-level="" data-path="docker-installation.html"><a href="docker-installation.html"><i class="fa fa-check"></i>Docker Installation</a>
<ul>
<li><a href="docker-installation.html#intro-bisque-docker-container"><strong>Intro: BisQue Docker Container</strong></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> BisQue Cloud Service</a>
<ul>
<li class="chapter" data-level="1.1" data-path="how-to-login-or-create-a-new-user.html"><a href="how-to-login-or-create-a-new-user.html"><i class="fa fa-check"></i><b>1.1</b> How to Login or Create a New User</a></li>
<li class="chapter" data-level="1.2" data-path="how-to-upload-data.html"><a href="how-to-upload-data.html"><i class="fa fa-check"></i><b>1.2</b> How to Upload Data</a>
<ul>
<li class="chapter" data-level="" data-path="how-to-upload-data.html"><a href="how-to-upload-data.html#step-1.-login"><i class="fa fa-check"></i>Step 1. Login</a></li>
<li class="chapter" data-level="" data-path="how-to-upload-data.html"><a href="how-to-upload-data.html#step-2.-upload-file-or-folder"><i class="fa fa-check"></i>Step 2. Upload File or Folder</a></li>
<li class="chapter" data-level="" data-path="how-to-upload-data.html"><a href="how-to-upload-data.html#step-3.-build-a-dataset"><i class="fa fa-check"></i>Step 3. Build a Dataset</a></li>
<li class="chapter" data-level="" data-path="how-to-upload-data.html"><a href="how-to-upload-data.html#step-4.-setting-permissions"><i class="fa fa-check"></i>Step 4. Setting Permissions</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="how-to-add-annotations.html"><a href="how-to-add-annotations.html"><i class="fa fa-check"></i><b>1.3</b> How to Add Annotations</a>
<ul>
<li class="chapter" data-level="" data-path="how-to-add-annotations.html"><a href="how-to-add-annotations.html#overview"><i class="fa fa-check"></i>Overview</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="how-to-run-a-module.html"><a href="how-to-run-a-module.html"><i class="fa fa-check"></i><b>1.4</b> How to Run a Module</a></li>
<li class="chapter" data-level="1.5" data-path="imagej-module.html"><a href="imagej-module.html"><i class="fa fa-check"></i><b>1.5</b> ImageJ Module</a>
<ul>
<li class="chapter" data-level="" data-path="imagej-module.html"><a href="imagej-module.html#overview-1"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="" data-path="imagej-module.html"><a href="imagej-module.html#uploading-of-imagej-pipelines"><i class="fa fa-check"></i>Uploading of ImageJ Pipelines</a></li>
<li class="chapter" data-level="" data-path="imagej-module.html"><a href="imagej-module.html#running-an-imagej-macro"><i class="fa fa-check"></i>Running an ImageJ Macro</a></li>
<li class="chapter" data-level="" data-path="imagej-module.html"><a href="imagej-module.html#special-bisque-extensions-for-imagej"><i class="fa fa-check"></i>Special BisQue extensions for ImageJ</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="cellprofiler-module.html"><a href="cellprofiler-module.html"><i class="fa fa-check"></i><b>1.6</b> CellProfiler Module</a>
<ul>
<li class="chapter" data-level="" data-path="cellprofiler-module.html"><a href="cellprofiler-module.html#overview-2"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="" data-path="cellprofiler-module.html"><a href="cellprofiler-module.html#uploading-of-cellprofiler-pipelines"><i class="fa fa-check"></i>Uploading of CellProfiler Pipelines</a></li>
<li class="chapter" data-level="" data-path="cellprofiler-module.html"><a href="cellprofiler-module.html#running-a-cellprofiler-pipeline"><i class="fa fa-check"></i>Running a CellProfiler Pipeline</a></li>
<li class="chapter" data-level="" data-path="cellprofiler-module.html"><a href="cellprofiler-module.html#results"><i class="fa fa-check"></i>Results</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="plant-cell-segmentation.html"><a href="plant-cell-segmentation.html"><i class="fa fa-check"></i><b>1.7</b> Plant Cell Segmentation</a>
<ul>
<li class="chapter" data-level="" data-path="plant-cell-segmentation.html"><a href="plant-cell-segmentation.html#overview-3"><i class="fa fa-check"></i>Overview</a></li>
<li><a href="plant-cell-segmentation.html#input"><strong><code>Input</code></strong></a></li>
<li class="chapter" data-level="" data-path="plant-cell-segmentation.html"><a href="plant-cell-segmentation.html#hyperparameters"><i class="fa fa-check"></i>Hyperparameters</a></li>
<li class="chapter" data-level="" data-path="plant-cell-segmentation.html"><a href="plant-cell-segmentation.html#cell-features"><i class="fa fa-check"></i>Cell Features</a></li>
<li><a href="plant-cell-segmentation.html#output"><strong><code>Output</code></strong></a></li>
</ul></li>
<li class="chapter" data-level="1.8" data-path="nph-prediction.html"><a href="nph-prediction.html"><i class="fa fa-check"></i><b>1.8</b> NPH Prediction</a>
<ul>
<li class="chapter" data-level="" data-path="nph-prediction.html"><a href="nph-prediction.html#overview-4"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="" data-path="nph-prediction.html"><a href="nph-prediction.html#step-1.-login-1"><i class="fa fa-check"></i>STEP 1. Login</a></li>
<li class="chapter" data-level="" data-path="nph-prediction.html"><a href="nph-prediction.html#step-2.-upload-images"><i class="fa fa-check"></i>STEP 2. Upload Image(s)</a></li>
<li class="chapter" data-level="" data-path="nph-prediction.html"><a href="nph-prediction.html#step-3.-go-to-nph-prediction-module-homepage"><i class="fa fa-check"></i>STEP 3. Go To NPH Prediction Module Homepage</a></li>
<li class="chapter" data-level="" data-path="nph-prediction.html"><a href="nph-prediction.html#step-4.-run-nph-prediction-module"><i class="fa fa-check"></i>STEP 4. Run NPH Prediction Module</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="module-development.html"><a href="module-development.html"><i class="fa fa-check"></i><b>2</b> MODULE DEVELOPMENT</a>
<ul>
<li><a href="module-development.html#how-to-begin-building-modules"><strong>How to Begin Building Modules</strong></a></li>
<li class="chapter" data-level="2.1" data-path="dockerfile.html"><a href="dockerfile.html"><i class="fa fa-check"></i><b>2.1</b> Dockerfile</a>
<ul>
<li><a href="dockerfile.html#example-composite-strength"><strong>Example: Composite Strength</strong></a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="module-xml.html"><a href="module-xml.html"><i class="fa fa-check"></i><b>2.2</b> Module XML</a>
<ul>
<li><a href="module-xml.html#example"><strong>Example</strong></a></li>
<li class="chapter" data-level="" data-path="module-xml.html"><a href="module-xml.html#module-description"><i class="fa fa-check"></i>Module Description</a></li>
<li class="chapter" data-level="" data-path="module-xml.html"><a href="module-xml.html#configurations-for-images-datasets-and-resources"><i class="fa fa-check"></i>Configurations for Images, Datasets, and Resources</a></li>
<li class="chapter" data-level="" data-path="module-xml.html"><a href="module-xml.html#data-parallel-execution"><i class="fa fa-check"></i>Data-Parallel Execution</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="python-script-wrapper.html"><a href="python-script-wrapper.html"><i class="fa fa-check"></i><b>2.3</b> Python Script Wrapper</a>
<ul>
<li><a href="python-script-wrapper.html#example.-python-script-wrapper"><em>Example.</em> Python Script Wrapper</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="source-code.html"><a href="source-code.html"><i class="fa fa-check"></i><b>2.4</b> Source Code</a>
<ul>
<li><a href="source-code.html#example.-composite-strength-module"><em>Example.</em> Composite Strength Module</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="runtime-module-configuration.html"><a href="runtime-module-configuration.html"><i class="fa fa-check"></i><b>2.5</b> Runtime Module Configuration</a>
<ul>
<li><a href="runtime-module-configuration.html#example.-composite-strength-module-1"><em>Example.</em> Composite Strength Module</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="python-setup.html"><a href="python-setup.html"><i class="fa fa-check"></i><b>2.6</b> Python Setup</a></li>
<li><a href="how-to-run-modules-locally.html#how-to-run-modules-locally"><strong>How to Run Modules Locally</strong></a>
<ul>
<li><a href="how-to-run-modules-locally.html#step-1.-pull-the-latest-dev-container"><strong>Step 1.</strong> Pull the Latest Dev Container</a></li>
<li><a href="how-to-run-modules-locally.html#step-2.-run-the-dev-container"><strong>Step 2.</strong> Run the Dev Container</a></li>
<li><a href="how-to-run-modules-locally.html#step-3.-register-modules"><strong>Step 3.</strong> Register Modules</a></li>
<li><a href="how-to-run-modules-locally.html#step-4.-run-the-module"><strong>Step 4.</strong> Run the Module</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="bqapi.html"><a href="bqapi.html"><i class="fa fa-check"></i><b>3</b> BQAPI</a>
<ul>
<li><a href="download-an-array.html#download-an-array"><strong>Download an Array</strong></a>
<ul>
<li class="chapter" data-level="" data-path="download-an-array.html"><a href="download-an-array.html"><i class="fa fa-check"></i>Access an HDF5 Table from BisQue</a></li>
</ul></li>
<li><a href="upload-an-image.html#upload-an-image"><strong>Upload an Image</strong></a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://bisque.ece.ucsb.edu/" target="blank">UCSB BisQue Cloud Platform</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Getting Started with BisQue</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="dockerfile" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Dockerfile</h2>
<blockquote>
<p><strong>FILENAME: </strong> <code>Dockerfile</code> This file will be used for the docker build process so try to keep the default naming convention.</p>
</blockquote>
<div id="defining-a-base-image" class="section level4 unnumbered">
<h4>Defining a Base Image</h4>
<p>Typically, a <code>Dockerfile</code> will include a base image such as <code>FROM ubuntu:xenial</code> at the top of the file. We highly recommend using the Ubuntu Xenial 16.04 image for your module as it has been tested rigorously and is the base image we use for BisQue.</p>
<p><strong>NOTE.</strong> If you would like to use a different Ubuntu flavor like 18.04 Bionic, we encourage you to do so and let us know of any problems you encounter.</p>
<p>We typically start off our module Dockerfiles with the following lines:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb6-1"><a href="dockerfile.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">FROM</span> ubuntu:xenial</span>
<span id="cb6-2"><a href="dockerfile.html#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="ex">ENV</span> DEBIAN_FRONTEND noninteractive</span>
<span id="cb6-3"><a href="dockerfile.html#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> apt-get -y update   <span class="kw">&amp;&amp;</span> <span class="kw">\</span></span>
<span id="cb6-4"><a href="dockerfile.html#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="ex">apt-get</span> -y upgrade  <span class="kw">&amp;&amp;</span> <span class="kw">\</span></span>
<span id="cb6-5"><a href="dockerfile.html#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="ex">apt-get</span> -y install python</span></code></pre></div>
</div>
<div id="apt-get-installs" class="section level4 unnumbered">
<h4>APT-GET Installs</h4>
<p>After these lines, we need to add dependencies for our module such as pip, headers, and any compilers. The next few lines are where we put any <code>apt-get</code> installs. Usually this is good practice since some pip install packages require a compiler. If one is not present in the container, it might be hard to debug what is missing.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb7-1"><a href="dockerfile.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> apt-get -y install python-pip liblapack3 libblas-dev liblapack-dev gfortran</span>
<span id="cb7-2"><a href="dockerfile.html#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> apt-get update   # <span class="op">&lt;</span>--- Run before pip installs</span></code></pre></div>
</div>
<div id="pip-installs" class="section level4 unnumbered">
<h4>PIP Installs</h4>
<p>Now we add any pip installs that our module may need such as <code>numpy</code>, <code>pandas</code>, <code>Tensorflow</code>, and any others. If you used a virtual environment to develop module locally, and hopefully you did, then simply use <code>pip freeze &gt; requirements.txt</code>. This will give you a text file with all the packages you are using in your virtual environment for your module. If you are a diligent person, you probably do not use one virtual environment for all your development in, say, Python 3.6. Hence, you will only have the necessary packages in the <code>requirements.txt</code> file. From this file, fill in the necessary pip installs within the Dockerfile.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb8-1"><a href="dockerfile.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> pip install numpy pandas tensorflow</span>
<span id="cb8-2"><a href="dockerfile.html#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> pip install scikit-learn==0.19.1   # <span class="op">&lt;</span>--- For specific versions</span>
<span id="cb8-3"><a href="dockerfile.html#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> pip install -i https://biodev.ece.ucsb.edu/py/bisque/prod/+simple bisque-api==0.5.9</span></code></pre></div>
</div>
<div id="working-directory-source-code" class="section level4 unnumbered">
<h4>Working Directory, Source Code</h4>
<p>We typically define the working directory as follows:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb9-1"><a href="dockerfile.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">WORKDIR</span> /module</span></code></pre></div>
<p>After this, you can put all of your source code along with the <code>PythonScriptWrapper</code> inside the <code>/modules</code> directory.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb10-1"><a href="dockerfile.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">COPY</span> PythonScriptWrapper /module/</span>
<span id="cb10-2"><a href="dockerfile.html#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="ex">COPY</span> PythonScriptWrapper.py /module/</span>
<span id="cb10-3"><a href="dockerfile.html#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="ex">COPY</span> YOUR_MODULE_SCRIPT.py /module/  #  <span class="op">&lt;</span>--- Source folders welcome too</span>
<span id="cb10-4"><a href="dockerfile.html#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="ex">COPY</span> pydist /module/pydist/</span>
<span id="cb10-5"><a href="dockerfile.html#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="ex">ENV</span> PATH /module:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span></code></pre></div>
<p>The last line is the <code>ENV</code> instruction which sets the environment variable <code>&lt;key&gt;</code> to the value <code>&lt;value&gt;</code>. This value will be in the environment for all subsequent instructions in the build stage and can be replaced inline in many as well.</p>
</div>
<div id="what-should-my-last-line-be" class="section level4 unnumbered">
<h4>What Should My Last Line Be?</h4>
<p>Your last line in the Dockerfile should be the <code>CMD</code> command. There can only be one <code>CMD</code> instruction in a Dockerfile. If you list more than one <code>CMD</code> then only the last <code>CMD</code> will take effect.</p>
<blockquote>
<p>The main purpose of a <code>CMD</code> is to provide defaults for an executing container.</p>
</blockquote>
<p>For us, we will use the <code>PythonScriptWrapper</code> as our <code>CMD</code> command as follows:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb11-1"><a href="dockerfile.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">CMD</span> [ <span class="st">&#39;PythonScriptWrapper&#39;</span> ]</span></code></pre></div>
<p>Simple, am I right? Letâ€™s put all this together in a concrete example.</p>
<hr />
</div>
<div id="example-composite-strength" class="section level3 unnumbered">
<h3><strong>Example: Composite Strength</strong></h3>
<p>The Composite Strength module requires a variety of special packages, such as a very specific version of <code>scikit-learn==0.19.1</code>. Please be aware that if you do pickle files using <code>scikit-learn</code>, you might have to use the same exact version to unpickle the file. Some of us found that out the hard way, hence the word of caution.</p>
<p>This simple mistake can be extended to any number of machine learning tasks. We recommend that for <em>maximum reproducibility</em>, use the exact same version of all pip install packages as you did on your local development environment.</p>
<div id="step-1.-define-base-image-run-apt-gets-install-python" class="section level4 unnumbered">
<h4>Step 1. Define Base Image, Run apt-gets, Install Python</h4>
<p>Similar to before, we will define our base image of Ubuntu Xenial, run the necessary <code>apt-gets</code> which is crucial, and install <code>Python</code>.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb12-1"><a href="dockerfile.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">FROM</span> ubuntu:xenial</span>
<span id="cb12-2"><a href="dockerfile.html#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="ex">ENV</span> DEBIAN_FRONTEND noninteractive</span>
<span id="cb12-3"><a href="dockerfile.html#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> apt-get -y update                                            <span class="kw">&amp;&amp;</span> <span class="kw">\</span></span>
<span id="cb12-4"><a href="dockerfile.html#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="ex">apt-get</span> -y upgrade                                           <span class="kw">&amp;&amp;</span> <span class="kw">\</span></span>
<span id="cb12-5"><a href="dockerfile.html#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="ex">apt-get</span> -y install                                              <span class="kw">\</span></span>
<span id="cb12-6"><a href="dockerfile.html#cb12-6" aria-hidden="true" tabindex="-1"></a>      <span class="ex">python</span></span></code></pre></div>
</div>
<div id="step-2.-install-needed-apt-get-packages-and-dependencies" class="section level4 unnumbered">
<h4>Step 2. Install Needed apt-get Packages and Dependencies</h4>
<div class="sourceCode" id="cb13"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb13-1"><a href="dockerfile.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> apt-get -y install python-lxml python-numpy</span>
<span id="cb13-2"><a href="dockerfile.html#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> apt-get -y install python-pip liblapack3 libblas-dev liblapack-dev gfortran</span>
<span id="cb13-3"><a href="dockerfile.html#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> apt-get -y install python-scipy python-configparser python-h5py</span>
<span id="cb13-4"><a href="dockerfile.html#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> apt-get update</span></code></pre></div>
</div>
<div id="step-3.-install-needed-pip-packages-and-dependencies" class="section level4 unnumbered">
<h4>Step 3. Install Needed PIP Packages and Dependencies</h4>
<p>Best practice is always to have your pip installs defined in the Dockerfile instead of in a <code>requirements.txt</code>. The more self-contained, the better.</p>
<p>Additionally, <strong>do not forget to install the <code>BQAPI</code> inside the container.</strong></p>
<pre><code>RUN pip install pymks tables scipy
RUN pip install --user --install-option=&quot;--prefix=&quot; -U scikit-learn==0.19.1
RUN pip install -i https://biodev.ece.ucsb.edu/py/bisque/prod/+simple bisque-api==0.5.9
RUN pip install requests==2.10.0</code></pre>
</div>
<div id="step-4.-set-working-directory-and-copy-source-files" class="section level4 unnumbered">
<h4>Step 4. Set Working Directory and COPY Source files</h4>
<p>The working directory should be defined as <code>/module</code> and in there, dump all your source code. If you want to be clean, use a <code>/source</code> folder in the <code>/module</code> directory. This is your module container and you have the control to customize the structure in any way that seems feasible to you. In this example, there is only one script that performs the entire analysis pipeline. Some might say too simple, others say efficient.</p>
<pre><code>WORKDIR /module
COPY PythonScriptWrapper /module/
COPY PythonScriptWrapper.py /module/
COPY predict_strength.py /module/
COPY pydist /module/pydist/
ENV PATH /module:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</code></pre>
</div>
<div id="step-5.-lastly-the-final-command." class="section level4 unnumbered">
<h4>Step 5. Lastly, the Final Command.</h4>
<p>Your final command should come as no surprise. The reason we use the PythonScriptWrapper is because it makes life easier for you. Your focus should be on developing breakthrough methods, not how to handshake between a cloud platform and a Docker container.</p>
<pre><code>CMD [ &#39;PythonScriptWrapper&#39; ]</code></pre>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="module-development.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="module-xml.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bisqueUCSB.pdf", "bisqueUCSB.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
